(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1256:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=a(3464).A.create({timeout:1e4,withCredentials:!0})},8166:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P});var l=a(5155),r=a(5695),i=a(2115),s=a(6643),n=a(2269),c=a(3032),o=a(5902),d=a(1769),u=a(1256);async function h(){try{return(await u.A.get("/website/config")).data}catch(e){throw e}}async function f(){return(await u.A.post("".concat("","/auth/refresh"))).data}var m=a(2842),p=a(8086);let x=()=>(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50",children:[(0,l.jsxs)("div",{className:"w-full max-w-sm p-6 bg-white rounded-lg shadow-md",children:[(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:120,height:50})}),(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:150,height:40})}),(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:150,height:20})}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})}),(0,l.jsx)("div",{className:"flex justify-center mb-4",children:(0,l.jsx)(p.default,{variant:"text",width:40,height:40})}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})})]}),(0,l.jsx)("div",{className:"flex justify-center mt-6",children:(0,l.jsx)(p.default,{variant:"text",width:200,height:20})})]});var g=a(7129),y=a(5358),v=a(6577),j=a(7764),b=a(7183),w=a(1283),N=a(6482);let A=e=>{let{length:t=4,onChange:a,onComplete:r,onFocus:s,onBlur:n,value:c}=e,[o,d]=(0,i.useState)(Array(t).fill("")),u=(0,i.useRef)(Array(t).fill(null));(0,i.useEffect)(()=>{a&&a(o.join("")),o.every(e=>e)&&r&&r(o.join(""))},[o]),(0,i.useEffect)(()=>{c&&d(e=>(Array.from({length:t}).forEach((t,a)=>{e[a]=c[a]||""}),e))},[c]);let h=(e,a)=>{let l=a.target.value;if(/^\d*$/.test(l)&&l.length<=1){let a=[...o];a[e]=l,JSON.stringify(a)!==JSON.stringify(o)&&(d(a),l&&e<t-1&&u.current[e+1].focus())}},f=(e,t)=>{"Backspace"===t.key&&!o[e]&&e>0&&u.current[e-1].focus()},m=e=>{u.current[e].select(),s&&s(e)},p=e=>{n&&n(e)},x=e=>{let a=e.clipboardData.getData("Text").trim();if(/^\d+$/.test(a)){let l=a.slice(0,t).split(""),r=[...o];l.forEach((e,t)=>{r[t]=e,u.current[t]&&(u.current[t].value=e)}),d(r);let i=l.length<t?l.length:t-1;u.current[i].focus(),e.preventDefault()}};return(0,l.jsx)("div",{dir:"ltr",className:"flex justify-center gap-2",children:o.map((e,t)=>(0,l.jsx)(v.A,{inputRef:e=>u.current[t]=e,value:e,onChange:e=>h(t,e),onKeyDown:e=>f(t,e),onFocus:()=>m(t),onBlur:()=>p(t),onPaste:x,inputProps:{maxLength:1,style:{textAlign:"center",width:"50px"}},variant:"outlined",type:"tel",className:"border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t))})};var _=a(9694),S=a(7312),F=a.n(S);function C(e){let{data:t,callback:a}=e,[r,s]=(0,i.useState)(1),[n,c]=(0,i.useState)(null),[o,d]=(0,i.useState)(null),h=g.Ik().shape({identifier:g.Yj().test("match-any","ورودی اشتباه است",function(e){return t.options.some(t=>new RegExp(t.regex).test(e))})}),f=(0,_.Wx)({initialValues:{identifier:""},validationSchema:h,onSubmit:async(e,l)=>{let{setSubmitting:i}=l;try{if(1===r){let a=t.options.find(t=>new RegExp(t.regex).test(e.identifier));if(a){c(a),d(a.secrets[0].type),s(2);let t={method:a.secrets[0].method,[a.identifier]:e.identifier};await u.A.post(a.api,t),a.secrets.forEach(e=>{f.setFieldValue(e.type,"")})}}else{let e=n.secrets.find(e=>e.type===o),t={[n.identifier]:f.values.identifier,[e.name]:f.values[e.type]};await u.A.post("".concat(e.api,"?callback=").concat(a),t),window.location.replace(a)}}catch(e){}finally{i(!1)}}});(0,i.useEffect)(()=>{n&&n.secrets.length>0&&d(n.secrets[0].type)},[n]),(0,i.useEffect)(()=>{if("OTPCredential"in window){console.log("OTPCredential in window");let e=new AbortController,t=!0;return navigator.credentials.get({otp:{transport:["sms"]},signal:e.signal}).then(e=>{console.log("otp",e),t&&(console.log("Web OTP API Response:",e),f.setFieldValue("otp",e.code),f.submitForm())}).catch(e=>{"AbortError"!==e.name&&t&&console.error("Web OTP API Error:",e)}),()=>{t=!1,e.abort()}}},[]);let m=async e=>{if(d(e),n){let t=n.secrets.find(t=>t.type===e);if(t){let e={method:t.method,[n.identifier]:f.values.identifier};try{await u.A.post(n.api,e),f.setFieldValue(t.type,"")}catch(e){console.error("API call failed while switching secret type:",e)}}}},p=()=>n?n.secrets.map((e,t)=>e.type===o?null:(0,l.jsxs)(j.A,{component:"button",variant:"body2",onClick:()=>m(e.type),className:"mr-4",children:["Try ",e.description]},t)):null;return(0,l.jsxs)("form",{onSubmit:f.handleSubmit,children:[1===r&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(v.A,{dir:"ltr",name:"identifier",label:t.options.map(e=>e.placeholder).join(", "),placeholder:t.options.map(e=>e.description).join(", "),fullWidth:!0,margin:"normal",value:f.values.identifier,onChange:f.handleChange,error:f.touched.identifier&&!!f.errors.identifier,helperText:f.touched.identifier&&f.errors.identifier,className:"mb-4"})}),2===r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(b.A,{startIcon:(0,l.jsx)(N.A,{}),onClick:()=>s(1),variant:"text",color:"primary",className:"mb-4 absolute -top-12 right-0",size:"small",children:["تغییر ",n.placeholder]}),(()=>{if(!n||!o)return null;let e=n.secrets.find(e=>e.type===o);return e?"otp"===e.type&&e.length?(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(y.A,{className:"mb-2",children:e.placeholder}),(0,l.jsx)(A,{length:e.length,value:f.values[e.type]||"",onChange:t=>{console.log("OTP changed:",t),f.setFieldValue(e.type,t)},onComplete:t=>{f.setFieldValue(e.type,t),f.submitForm()},onFocus:()=>f.setFieldTouched(e.type,!0),onBlur:()=>f.setFieldTouched(e.type,!0)})]}):(0,l.jsx)(v.A,{dir:"ltr",name:e.type,label:e.placeholder,placeholder:e.description,type:"password"===e.type?"password":"text",fullWidth:!0,margin:"normal",className:"mb-4",value:f.values[e.type]||"",onChange:f.handleChange,error:f.touched[e.type]&&!!f.errors[e.type],helperText:f.touched[e.type]&&f.errors[e.type]}):null})(),!F()(p()[0])&&(0,l.jsx)(y.A,{variant:"body2",className:"mt-2 mb-4",children:"یا راه های زیر را امتحان کنید:"}),(0,l.jsx)("div",{className:"flex flex-col mb-4",children:p()})]}),(0,l.jsx)(w.A,{type:"submit",variant:"contained",color:"primary",loading:f.isSubmitting,disabled:f.isSubmitting,fullWidth:!0,className:"mt-4",children:1===r?"ارسال":"ورود"})]})}function E(e){let{data:t}=e;return(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("img",{src:t.logo,alt:t.title,className:"w-32 object-contain mx-auto mb-4"}),(0,l.jsx)(y.A,{variant:"h4",className:"mb-2",children:t.title}),(0,l.jsx)(y.A,{variant:"subtitle1",children:t.description})]})}function k(e){let{providers:t,callback:a}=e;return(0,l.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,l.jsx)(w.A,{fullWidth:!0,variant:"outlined",endIcon:(0,l.jsx)("img",{src:e.icon,alt:"".concat(e.text," icon"),className:"w-6 h-6 object-contain"}),className:"justify-center gap-4 normal-case py-2 text-base font-normal",href:"".concat(e.url,"?callback=").concat(a),children:e.text},t))})}function O(e){let{data:t}=e;return(0,l.jsxs)(y.A,{variant:"body2",className:"mt-8 text-gray-600",children:[!F()(t.terms)&&(0,l.jsx)("a",{href:t.terms,className:"hover:underline mr-4",children:"شرایط استفاده"}),!F()(t.terms)&&!F()(t.privacy)&&"  |  ",!F()(t.privacy)&&(0,l.jsx)("a",{href:t.privacy,className:"hover:underline",children:"سیاست حفظ حریم خصوصی"})]})}function P(){var e,t,a,u,p,g,y,v,j,b,w,N,A,_,S;let P=(0,r.useSearchParams)().get("callback"),[T]=(0,m.lT)(["usso_refresh_available"]),I=()=>{let e=new URL(window.location.href).hostname.split(".").slice(-2).join(".");return"https://".concat(e)},W=(0,d.I)({queryKey:["refresh"],queryFn:f,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1}),R=(0,d.I)({queryKey:["configs"],queryFn:h});if((0,i.useEffect)(()=>{if(W.isSuccess&&R.isSuccess&&T.usso_refresh_available){var e;window.location.href=P||(null==(e=R.data)?void 0:e.default_redirect_url)||I()}},[W.isSuccess,R.isSuccess,T.usso_refresh_available]),R.isLoading||W.isLoading)return(0,l.jsx)(x,{});let V=(0,o.A)({cssVariables:!0,direction:"rtl",typography:{...null==(t=R.data)||null==(e=t.branding)?void 0:e.typography},shape:{...null==(u=R.data)||null==(a=u.branding)?void 0:a.shape},palette:{...null==(g=R.data)||null==(p=g.branding)?void 0:p.palette}}),q=null==(v=R.data)||null==(y=v.methods)?void 0:y.filter(e=>"credential"==e.type)[0],D=null==(b=R.data)||null==(j=b.methods)?void 0:j.filter(e=>"provider"==e.type);return(0,l.jsx)(s.A,{theme:V,children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen bg-gray-50",children:[(0,l.jsxs)(n.A,{className:"bg-white p-8 rounded-lg w-full max-w-80 shadow-none md:max-w-sm md:shadow-md relative",children:[(0,l.jsx)(E,{data:null==(w=R.data)?void 0:w.branding}),(0,l.jsx)(C,{data:q,callback:P||(null==(N=R.data)?void 0:N.default_redirect_url)||I()}),!F()(D)&&(0,l.jsx)(c.A,{className:"my-6",children:"یا"}),(0,l.jsx)(k,{providers:D,callback:P||(null==(A=R.data)?void 0:A.default_redirect_url)||I()})]}),!F()(null==(_=R.data)?void 0:_.legal)&&(0,l.jsx)(O,{data:null==(S=R.data)?void 0:S.legal})]})})}},9949:(e,t,a)=>{Promise.resolve().then(a.bind(a,8166))}},e=>{var t=t=>e(e.s=t);e.O(0,[352,86,796,727,441,684,358],()=>t(9949)),_N_E=e.O()}]);