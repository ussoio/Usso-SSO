(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1256:(e,t,a)=>{"use strict";a.d(t,{A:()=>n,p:()=>r});var l=a(3464);let r="",n=l.A.create({timeout:1e4,withCredentials:!0})},6397:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var l=a(5155),r=a(5695),n=a(2115),i=a(6643),s=a(2269),c=a(3032),o=a(5902),d=a(1769),u=a(1256);async function h(){try{return(await u.A.get("/website/config")).data}catch(e){throw e}}async function f(){return(await u.A.post("".concat(u.p,"/auth/refresh"))).data}var m=a(2842),p=a(8086);let x=()=>(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50",children:[(0,l.jsxs)("div",{className:"w-full max-w-sm p-6 bg-white rounded-lg shadow-md",children:[(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:120,height:50})}),(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:150,height:40})}),(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)(p.default,{variant:"rectangular",width:150,height:20})}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})}),(0,l.jsx)("div",{className:"flex justify-center mb-4",children:(0,l.jsx)(p.default,{variant:"text",width:40,height:40})}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)(p.default,{variant:"rectangular",width:"100%",height:40})})]}),(0,l.jsx)("div",{className:"flex justify-center mt-6",children:(0,l.jsx)(p.default,{variant:"text",width:200,height:20})})]});var g=a(7129),y=a(5358),v=a(6577),j=a(7764),b=a(7183),w=a(1283),N=a(6482);let A=e=>{let{length:t=4,onChange:a,onComplete:r,onFocus:i,onBlur:s,value:c}=e,[o,d]=(0,n.useState)(Array(t).fill("")),u=(0,n.useRef)(Array(t).fill(null));(0,n.useEffect)(()=>{a&&a(o.join("")),o.every(e=>e)&&r&&r(o.join(""))},[o]),(0,n.useEffect)(()=>{c&&d(e=>(Array.from({length:t}).forEach((t,a)=>{e[a]=c[a]||""}),e))},[c]);let h=(e,a)=>{let l=a.target.value;if(/^\d*$/.test(l)&&l.length<=1){let a=[...o];a[e]=l,JSON.stringify(a)!==JSON.stringify(o)&&(d(a),l&&e<t-1&&u.current[e+1].focus())}},f=(e,t)=>{"Backspace"===t.key&&!o[e]&&e>0&&u.current[e-1].focus()},m=e=>{u.current[e].select(),i&&i(e)},p=e=>{s&&s(e)},x=e=>{let a=e.clipboardData.getData("Text").trim();if(/^\d+$/.test(a)){let l=a.slice(0,t).split(""),r=[...o];l.forEach((e,t)=>{r[t]=e,u.current[t]&&(u.current[t].value=e)}),d(r);let n=l.length<t?l.length:t-1;u.current[n].focus(),e.preventDefault()}};return(0,l.jsx)("div",{dir:"ltr",className:"flex justify-center gap-2",children:o.map((e,t)=>(0,l.jsx)(v.A,{inputRef:e=>u.current[t]=e,value:e,onChange:e=>h(t,e),onKeyDown:e=>f(t,e),onFocus:()=>m(t),onBlur:()=>p(t),onPaste:x,inputProps:{maxLength:1,style:{textAlign:"center",width:"50px"}},variant:"outlined",type:"tel",className:"border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t))})};var _=a(9694),C=a(7312),S=a.n(C);function E(e){let{data:t,callback:a}=e,[r,i]=(0,n.useState)(1),[s,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),h=g.Ik().shape({identifier:g.Yj().test("match-any","ورودی اشتباه است",function(e){return t.options.some(t=>new RegExp(t.regex).test(e))})}),f=(0,_.Wx)({initialValues:{identifier:""},validationSchema:h,onSubmit:async(e,l)=>{let{setSubmitting:n}=l;try{if(1===r){let a=t.options.find(t=>new RegExp(t.regex).test(e.identifier));if(a){c(a),d(a.secrets[0].type),i(2);let t={method:a.secrets[0].method,[a.identifier]:e.identifier};await u.A.post(a.api,t),a.secrets.forEach(e=>{f.setFieldValue(e.type,"")})}}else{let e=s.secrets.find(e=>e.type===o),t={[s.identifier]:f.values.identifier,[e.name]:f.values[e.type]};await u.A.post("".concat(e.api,"?callback=").concat(a),t),window.location.replace(a)}}catch(e){}finally{n(!1)}}});(0,n.useEffect)(()=>{s&&s.secrets.length>0&&d(s.secrets[0].type)},[s]),(0,n.useEffect)(()=>{if("OTPCredential"in window){console.log("OTPCredential in window");let e=new AbortController,t=!0;return navigator.credentials.get({otp:{transport:["sms"]},signal:e.signal}).then(e=>{console.log("otp",e),t&&(console.log("Web OTP API Response:",e),f.setFieldValue("otp",e.code),f.submitForm())}).catch(e=>{"AbortError"!==e.name&&t&&console.error("Web OTP API Error:",e)}),()=>{t=!1,e.abort()}}},[]);let m=async e=>{if(d(e),s){let t=s.secrets.find(t=>t.type===e);if(t){let e={method:t.method,[s.identifier]:f.values.identifier};try{await u.A.post(s.api,e),f.setFieldValue(t.type,"")}catch(e){console.error("API call failed while switching secret type:",e)}}}},p=()=>s?s.secrets.map((e,t)=>e.type===o?null:(0,l.jsxs)(j.A,{component:"button",variant:"body2",onClick:()=>m(e.type),className:"mr-4",children:["Try ",e.description]},t)):null;return(0,l.jsxs)("form",{onSubmit:f.handleSubmit,children:[1===r&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(v.A,{dir:"ltr",name:"identifier",label:t.options.map(e=>e.placeholder).join(", "),placeholder:t.options.map(e=>e.description).join(", "),fullWidth:!0,margin:"normal",value:f.values.identifier,onChange:f.handleChange,error:f.touched.identifier&&!!f.errors.identifier,helperText:f.touched.identifier&&f.errors.identifier,className:"mb-4"})}),2===r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(b.A,{startIcon:(0,l.jsx)(N.A,{}),onClick:()=>i(1),variant:"text",color:"primary",className:"mb-4 absolute -top-12 right-0",size:"small",children:["تغییر ",s.placeholder]}),(()=>{if(!s||!o)return null;let e=s.secrets.find(e=>e.type===o);return e?"otp"===e.type&&e.length?(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(y.A,{className:"mb-2",children:e.placeholder}),(0,l.jsx)(A,{length:e.length,value:f.values[e.type]||"",onChange:t=>{console.log("OTP changed:",t),f.setFieldValue(e.type,t)},onComplete:t=>{f.setFieldValue(e.type,t),f.submitForm()},onFocus:()=>f.setFieldTouched(e.type,!0),onBlur:()=>f.setFieldTouched(e.type,!0)})]}):(0,l.jsx)(v.A,{dir:"ltr",name:e.type,label:e.placeholder,placeholder:e.description,type:"password"===e.type?"password":"text",fullWidth:!0,margin:"normal",className:"mb-4",value:f.values[e.type]||"",onChange:f.handleChange,error:f.touched[e.type]&&!!f.errors[e.type],helperText:f.touched[e.type]&&f.errors[e.type]}):null})(),!S()(p()[0])&&(0,l.jsx)(y.A,{variant:"body2",className:"mt-2 mb-4",children:"یا راه های زیر را امتحان کنید:"}),(0,l.jsx)("div",{className:"flex flex-col mb-4",children:p()})]}),(0,l.jsx)(w.A,{type:"submit",variant:"contained",color:"primary",loading:f.isSubmitting,disabled:f.isSubmitting,fullWidth:!0,className:"mt-4",children:1===r?"ارسال":"ورود"})]})}function F(e){let{data:t}=e;return(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("img",{src:t.logo,alt:t.title,className:"w-32 object-contain mx-auto mb-4"}),(0,l.jsx)(y.A,{variant:"h4",className:"mb-2",children:t.title}),(0,l.jsx)(y.A,{variant:"subtitle1",children:t.description})]})}function k(e){let{providers:t,callback:a}=e;return(0,l.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,l.jsx)(w.A,{fullWidth:!0,variant:"outlined",endIcon:(0,l.jsx)("img",{src:e.icon,alt:"".concat(e.text," icon"),className:"w-6 h-6 object-contain"}),className:"justify-center gap-4 normal-case py-2 text-base font-normal",href:"".concat(e.url,"?callback=").concat(a),children:e.text},t))})}function P(e){let{data:t}=e;return(0,l.jsxs)(y.A,{variant:"body2",className:"mt-8 text-gray-600",children:[!S()(t.terms)&&(0,l.jsx)("a",{href:t.terms,className:"hover:underline mr-4",children:"شرایط استفاده"}),!S()(t.terms)&&!S()(t.privacy)&&"  |  ",!S()(t.privacy)&&(0,l.jsx)("a",{href:t.privacy,className:"hover:underline",children:"سیاست حفظ حریم خصوصی"})]})}function O(){var e,t,a,u,p,g,y,v,j,b,w,N,A,_,C;let O=(0,r.useSearchParams)().get("callback"),[T]=(0,m.lT)(["usso_refresh_available"]),I=()=>{let e=new URL(window.location.href).hostname.split(".").slice(-2).join(".");return"https://".concat(e)},L=e=>{let t=[window.location.hostname];return(null==e?void 0:e.allowed_domains)||t},R=(0,d.I)({queryKey:["refresh"],queryFn:f,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1}),W=(0,d.I)({queryKey:["configs"],queryFn:h});if((0,n.useEffect)(()=>{if(R.isSuccess&&W.isSuccess&&T.usso_refresh_available){var e;let t=function(e,t){if(!e)return null;try{let a=new URL(e);if(!t.some(e=>a.hostname===e||a.hostname.includes("".concat(e)))||"https:"!==a.protocol)return null;return a.searchParams.forEach((e,t)=>{(t.toLowerCase().includes("script")||t.toLowerCase().includes("javascript")||t.toLowerCase().includes("data"))&&a.searchParams.delete(t)}),a.toString()}catch(e){return null}}(O,L(W.data))||(null==(e=W.data)?void 0:e.default_redirect_url)||I();window.location.href=t}},[R.isSuccess,W.isSuccess,T.usso_refresh_available]),W.isLoading||R.isLoading)return(0,l.jsx)(x,{});let V=(0,o.A)({cssVariables:!0,direction:"rtl",typography:{...null==(t=W.data)||null==(e=t.branding)?void 0:e.typography},shape:{...null==(u=W.data)||null==(a=u.branding)?void 0:a.shape},palette:{...null==(g=W.data)||null==(p=g.branding)?void 0:p.palette}}),q=null==(v=W.data)||null==(y=v.methods)?void 0:y.filter(e=>"credential"==e.type)[0],D=null==(b=W.data)||null==(j=b.methods)?void 0:j.filter(e=>"provider"==e.type);return(0,l.jsx)(i.A,{theme:V,children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen bg-gray-50",children:[(0,l.jsxs)(s.A,{className:"bg-white p-8 rounded-lg w-full max-w-80 shadow-none md:max-w-sm md:shadow-md relative",children:[(0,l.jsx)(F,{data:null==(w=W.data)?void 0:w.branding}),(0,l.jsx)(E,{data:q,callback:O||(null==(N=W.data)?void 0:N.default_redirect_url)||I()}),!S()(D)&&(0,l.jsx)(c.A,{className:"my-6",children:"یا"}),(0,l.jsx)(k,{providers:D,callback:O||(null==(A=W.data)?void 0:A.default_redirect_url)||I()})]}),!S()(null==(_=W.data)?void 0:_.legal)&&(0,l.jsx)(P,{data:null==(C=W.data)?void 0:C.legal})]})})}},9949:(e,t,a)=>{Promise.resolve().then(a.bind(a,6397))}},e=>{var t=t=>e(e.s=t);e.O(0,[352,86,796,727,441,684,358],()=>t(9949)),_N_E=e.O()}]);